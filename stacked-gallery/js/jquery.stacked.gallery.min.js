// jquery.stacked.gallery.min.js - Pretty stacked photos that can be clicked through
// Version: 1.0
// Author: Anna Drazich
// Website: http://www.initanna.com/stacked-gallery/
// Github: https://github.com/adrazich/stacked-gallery
//
// Copyright (c) 2012 Anna Drazich
// Dual licensed under the MIT and GPL licenses.
// MIT License: https://github.com/adrazich/stacked-gallery/blob/master/MIT-License.txt
// GPL License: https://github.com/adrazich/stacked-gallery/blob/master/GPL-License.txt
(function(b,p,q,l){b.fn.stackedGallery=function(e){var a=_defaults=b.extend({rotationMin:-20,rotationMax:20,rotationSpeed:300,transitionIn:"linear",transitionOut:"linear",width:400,height:400,controls:!0,_selector:this.selector},e);return this.each(function(){function e(){b(a._selector+" IMG").wrapAll('<div class="photos" />');var c=0,d="";b(a._selector+" .photos IMG").wrap(function(){c++;d=a._selector.replace(/\#|\./g,"");this.id=d+"-"+c;return'<div class="photo" ref="'+d+"-"+c+'" />'});b(a._selector+
" .photos .photo").each(function(){var c=b(this).width(),d=b(this).children("IMG").width();c<a.width&&0!=d&&(c=a.width-d>>1,b(this).css({left:c+"px"}))})}function j(){var c=b(a._selector+" .photos .active"),d=c.index();a.controls&&(d-=1);d+=1;d>=f&&(d=0);var h=b(a._selector+" .photos .photo").eq(d),i=b("#"+c.attr("ref")).width(),e=b("#"+c.attr("ref")).height();a.controls&&g();c.stop().animate({marginLeft:"+="+i+"px",marginTop:"-="+(e>>1)+"px"},250,a.transitionIn,function(){c.animate({marginLeft:"-="+
i+"px",marginTop:"+="+(e>>1)+"px"},150,a.transitionOut,function(){b("#"+c.attr("ref")).rotate({animateTo:Math.round(a.rotationMin+Math.random()*(a.rotationMax-a.rotationMin)),duration:a.rotationSpeed});b("#"+h.attr("ref")).rotate({animateTo:0,duration:a.rotationSpeed,callback:m})});n();h.css({zIndex:f}).addClass("active");c.css({zIndex:1}).removeClass("active")})}function m(){a.controls&&k()}function o(){var c=b("<div />").addClass("controls");c.append("<ul />");c.children("UL").append('<a title="Next"><li class="next">Next</li></a>');
c.children("UL").append('<a title="Full View"><li class="fullview">Full View</li></a>');b(a._selector+" .photos").prepend(c)}function k(){g();var c=b("#"+b(a._selector+" .photos .active").attr("ref"));b(a._selector+" .photos .controls").css({width:c.width()+parseInt(c.css("border-left-width"))+parseInt(c.css("border-right-width"))+"px",height:c.height()+"px",left:b(a._selector+" .photos .active").css("left")}).show();var c=parseInt(b(a._selector+" .photos .controls UL LI").css("margin-right")),d=
(b(a._selector+" .photos .controls UL LI").width()+c)*b(a._selector+" .photos .controls UL LI").length-c,c=b(a._selector+" .photos .controls UL LI").height(),e=b(a._selector+" .photos .controls").width(),f=b(a._selector+" .photos .controls").height(),d=e-d>>1,c=f-c>>1;b(a._selector+" .photos .controls UL").css({marginLeft:d+"px",marginTop:c+"px"})}function g(){b(a._selector+" .photos .controls").hide()}function n(){b(a._selector+" .photos .photo").each(function(){b(this).css({zIndex:parseInt(b(this).css("z-index"))+
1})})}var f=0;(function(){b(a._selector).addClass("stacked-gallery");e();z=f=b(a._selector+" .photos .photo").length;b(a._selector+" .photos .photo").each(function(c){0==c?(b(this).addClass("active").css({zIndex:f}),b(this).children("IMG").css({maxWidth:a.width+"px",maxHeight:a.width+"px"})):(b(this).css({zIndex:z}),b(this).children("IMG").css({maxWidth:a.width+"px",maxHeight:a.width+"px"}),b("#"+b(this).attr("ref")).rotate(Math.round(a.rotationMin+Math.random()*(a.rotationMax-a.rotationMin))));z--});
a.controls&&o()})();a.controls?(b(a._selector+" .photos .controls .next").on("click",function(a){a.preventDefault();j()}),b(a._selector+" .photos .controls .fullview").on("click",function(c){c.preventDefault();var c=b("#"+b(a._selector+" .photos .active").attr("ref")),d=c.attr("src");d==l&&(d=c.html(),d=c.html().match(/http:\/\/.*(\.png|\.jpg|\.jpeg|\.gif)/),d=d[0]);b.fancybox(d,{type:"image"})}),b(a._selector+" .photos").on("mouseenter",function(){k()}).on("mouseleave",function(){g()})):b(a._selector+
" .photos .active").live("click",function(a){a.preventDefault();j()})})}})(jQuery,window,document);